
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mosam - Khanpur Mahar</title>
  <style>
    body {
      margin: 0;
      padding: 1em;
      font-family: sans-serif;
      background: #f3f4f6;
      color: #111;
    }

    h1 {
      text-align: center;
      margin-bottom: 1em;
    }

    #location-select {
      display: block;
      margin: 0 auto 1.5em auto;
      padding: 0.5em;
      font-size: 1em;
    }

    #forecast {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1em;
    }

    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 1em;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .card h3 {
      margin-top: 0;
      font-size: 1em;
      color: #333;
    }

    .item {
      margin: 4px 0;
    }

    .footer {
      text-align: center;
      font-size: 0.9em;
      color: #666;
      margin-top: 2em;
    }
  </style>
</head>
<body>
  <h1>📍 Mosam ka Haal</h1>
  <select id="location-select">
    <option value="27.84088,69.41302">Khanpur Mahar</option>
    <option value="28.00604,69.31608">Ghotki</option>
    <option value="24.8607,67.0011">Karachi</option>
    <option value="31.5497,74.3436">Lahore</option>
    <option value="33.6844,73.0479">Islamabad</option>
  </select>

  <div id="forecast">Loading...</div>

  <div class="footer">Weather from Open-Meteo & Met.no | Developed with ❤️</div>

  <script>
    async function fetchWeather(lat, lon) {
      const forecastEl = document.getElementById("forecast");
      forecastEl.innerHTML = "Loading...";

      const openMeteoURL = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,precipitation_probability,wind_speed_10m,weathercode&timezone=Asia%2FKarachi`;
      const metNoURL = `https://api.met.no/weatherapi/locationforecast/2.0/compact?lat=${lat}&lon=${lon}`;

      const [omRes, metRes] = await Promise.all([
        fetch(openMeteoURL),
        fetch(metNoURL, {
          headers: {
            "User-Agent": "WeatherCompare/1.0 contact@example.com"
          }
        })
      ]);

      const om = await omRes.json();
      const met = await metRes.json();

      const omTime = om.hourly.time;
      const omTemp = om.hourly.temperature_2m;
      const omRain = om.hourly.precipitation_probability;
      const omWind = om.hourly.wind_speed_10m;
      const omCode = om.hourly.weathercode;
      const metSeries = met.properties.timeseries;

      const codeMap = {
        0: "Bilkul saaf", 1: "Thora badal", 2: "Halka badal", 3: "Buhat badal",
        45: "Dhond", 48: "Thandi dhond", 51: "Boonda", 61: "Halki barish",
        63: "Tez barish", 80: "Halki barish", 81: "Tez barish", 82: "Bari tez barish",
        95: "Bijli/toofan"
      };

      function weatherMet(desc) {
        const d = desc.toLowerCase();
        if (d.includes("clear")) return "Bilkul saaf";
        if (d.includes("partly") || d.includes("scattered")) return "Halka badal";
        if (d.includes("cloud")) return "Buhat badal";
        if (d.includes("fog")) return "Dhond";
        if (d.includes("rain") && d.includes("heavy")) return "Tez barish";
        if (d.includes("rain")) return "Halki barish";
        if (d.includes("thunder")) return "Bijli/toofan";
        return "Pata nahi";
      }

      function windFeel(speed) {
        if (speed >= 10) return "Tez hawa";
        if (speed >= 5) return "Darmiyani hawa";
        return "Halki hawa";
      }

      const now = new Date();
      let content = "";

      for (let i = 0; i < Math.min(48, omTime.length); i++) {
        const t = new Date(omTime[i]);
        if (t < now) continue;

        const dateStr = t.toLocaleDateString("ur-PK", {
          day: "2-digit", month: "long", year: "numeric"
        });
        const timeStr = t.toLocaleTimeString("en-US", {
          hour: "2-digit", minute: "2-digit"
        });

        const descOM = codeMap[omCode[i]] || "Pata nahi";
        const feelOM = windFeel(omWind[i]);
        const temp = omTemp[i];
        const rain = omRain[i];
        const wind = omWind[i];

        const metEntry = metSeries.find(e => {
          const mt = new Date(e.time);
          return mt.getHours() === t.getHours() && mt.getDate() === t.getDate();
        });

        let descMet = "N/A", feelMet = "N/A";
        if (metEntry) {
          const windMet = metEntry.data.instant.details.wind_speed;
          const summary = (metEntry.data.next_1_hours?.summary?.symbol_code) || "";
          descMet = weatherMet(summary);
          feelMet = windFeel(windMet);
        }

        content += `
          <div class="card">
            <h3>📅 ${dateStr} – 🕒 ${timeStr}</h3>
            <div class="item">🌤️ <b>Mosam (Open-Meteo):</b> ${descOM}</div>
            <div class="item">🌡️ <b>Hararat:</b> ${temp}°C</div>
            <div class="item">🌧️ <b>Barish:</b> ${rain}%</div>
            <div class="item">🌬️ <b>Hawa:</b> ${wind} m/s</div>
            <div class="item">🌀 <b>Ehsaas:</b> ${feelOM}</div>
            <div class="item">🌤️ <b>Met.no:</b> ${descMet}</div>
            <div class="item">🌀 <b>Hawa (Met.no):</b> ${feelMet}</div>
          </div>
        `;
      }

      forecastEl.innerHTML = content;
    }

    const selector = document.getElementById("location-select");
    selector.addEventListener("change", () => {
      const [lat, lon] = selector.value.split(",");
      fetchWeather(lat, lon);
    });

    window.onload = () => {
      const [lat, lon] = selector.value.split(",");
      fetchWeather(lat, lon);
    };
  </script>
</body>
</html>
