<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Weather Forecast</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { margin:0; padding:1em; font-family:Arial,sans-serif; background:#f3f4f6; color:#111 }
    h1 { text-align:center; margin-bottom:1em; }
    #search-box { display:flex; justify-content:center; gap:.5em; margin-bottom:1.5em; }
    #location-input { flex:1; padding:.5em; font-size:1em; }
    #forecast { display:grid; gap:1em; max-width:1600px; margin:auto;
      grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
    }
    @media (max-width:480px)  { #forecast { grid-template-columns:repeat(2,1fr) } }
    @media (min-width:481px) and (max-width:768px) { #forecast { grid-template-columns:repeat(4,1fr) } }
    @media (min-width:769px) { #forecast { grid-template-columns:repeat(8,1fr) } }
    .card { background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.1);
      padding:1em; transition:transform .2s; }
    .card:hover { transform:scale(1.05) }
    .card h3 { margin:0 0 .5em; font-size:1em; color:#333 }
    .item { margin:4px 0 }
    .footer { text-align:center; font-size:.9em; color:#666; margin-top:2em }
    button { padding:.5em 1em; font-size:1em; }
  </style>
</head>
<body>
  <h1 id="title">ğŸ“ Weather Forecast</h1>

  <div id="search-box">
    <input type="text" id="location-input" placeholder="Type city nameâ€¦">
    <button id="search-btn">ğŸ” Search</button>
  </div>

  <div id="forecast">Loadingâ€¦</div>
  <div class="footer" id="footer">Weather from Open-Meteo & Met.no</div>

  <script>
  let lang = 'en';
  let labels = {};

  // 1) Detect IP & region â†’ set lang
  fetch('https://ipapi.co/json/')
    .then(r=>r.json())
    .then(info=>{
      if(info.country_code!=='PK') lang='en';
      else if(info.region==='Sindh') lang='sd';   // Sindhi
      else lang='ur';                             // Urdu
      loadLabels();
    })
    .catch(_=>{ lang='en'; loadLabels() });

  function loadLabels(){
    const all = {
      en:{
        title: 'ğŸ“ Weather Forecast',
        placeholder: 'Type city nameâ€¦',
        btn: 'ğŸ” Search',
        footer: 'Weather from Open-Meteo & Met.no',
        mapsErr: 'Location not found.',
        code: {0:"Clear",1:"Few clouds",2:"Partly cloudy",3:"Overcast",
               45:"Fog",48:"Freezing fog",51:"Light drizzle",
               61:"Light rain",63:"Moderate rain",80:"Light showers",
               81:"Moderate showers",82:"Heavy showers",95:"Thunderstorm"},
        weatherMet(d){ d=d.toLowerCase(); if(d.includes("clear"))return"Clear";
          if(d.includes("partly")||d.includes("scattered"))return"Partly cloudy";
          if(d.includes("cloud"))return"Overcast"; if(d.includes("fog"))return"Fog";
          if(d.includes("rain")&&d.includes("heavy"))return"Heavy rain";
          if(d.includes("rain"))return"Light rain"; if(d.includes("thunder"))return"Thunderstorm";
          return"Unknown"; },
        windFeel(s){ if(s>=10)return"Strong wind"; if(s>=5)return"Moderate wind"; return"Light wind"; }
      },
      ur:{
        title: 'ğŸ“ Mosam Ka Haal',
        placeholder: 'Shahar ka naam likheinâ€¦',
        btn: 'ğŸ” Talaash',
        footer: 'Weather from Open-Meteo & Met.no',
        mapsErr: 'Location nahi mili.',
        code:{0:"Aasman bilkul saaf",1:"Thore badal",2:"Halka badal",3:"Buzd badal",
              45:"Dhond",48:"Thandi dhond",51:"Boonda baandi",
              61:"Halki barish",63:"Tez barish",80:"Halki showers",
              81:"Tez showers",82:"Bari tez showers",95:"Bijli/Toofan"},
        weatherMet(d){d=d.toLowerCase();if(d.includes("clear"))return"Aasman saaf";
          if(d.includes("partly")||d.includes("scattered"))return"Halka badal";
          if(d.includes("cloud"))return"Buzd badal";if(d.includes("fog"))return"Dhond";
          if(d.includes("rain")&&d.includes("heavy"))return"Tez barish";
          if(d.includes("rain"))return"Halki barish";if(d.includes("thunder"))return"Bijli/Toofan";
          return"Pata nahi";},
        windFeel(s){if(s>=10)return"Tez hawa";if(s>=5)return"Darmiyani hawa";return"Halki hawa";}
      },
      sd:{
        title: 'ğŸ“ Ù…ÙˆØ³Ù… Ø¬Ùˆ Ø­Ø§Ù„',
        placeholder: 'Ø´ÛØ± Ø¬Ùˆ Ù†Ø§Ù„Ùˆ Ù„Ú©Ùˆâ€¦',
        btn: 'ğŸ” Ú³ÙˆÙ„Ø§',
        footer: 'Weather from Open-Meteo & Met.no',
        mapsErr: 'Ø¬Ú³Ú¾ Ù†Ù‡ Ù…Ù„ÙŠ.',
        code:{0:"Ø³Ø§Ø¦Ùˆ Ø¢Ø³Ù…Ø§Ù†",1:"Ù¿ÙˆØ±Ø§ Ø¨Ø¯Ù„Ø§",2:"Ù‡Ù„ÚªØ§ Ø¨Ø¯Ù„Ø§",3:"Ú¯Ù‡Ú»Ùˆ Ø¨Ø¯Ù„Ø§",
              45:"ÚŒÙ†ÚŒ",48:"Ù¿ÚŒÙŠ ÚŒÙ†ÚŒ",51:"Ù‡Ù„ÚªÙˆ Ú¦Ø±Ø§Ú±Ùˆ",
              61:"Ù‡Ù„ÚªÙŠ Ø¨Ø±Ø³Ø§Øª",63:"Ø²ÙˆÚ Ø¨Ø±Ø³Ø§Øª",80:"Ù‡Ù„ÚªÙŠ Ú¦Ø±Ø§Ú±Ø§",
              81:"Ø²ÙŠÙˆÚ™ Ú¦Ø±Ø§Ú±Ø§",82:"Ú¯Ù‡Ú»Ø§ Ú¦Ø±Ø§Ú±Ø§",95:"Ø¨Ø¬Ù„ÙŠ/Ø·ÙˆÙØ§Ù†"},
        weatherMet(d){d=d.toLowerCase();if(d.includes("clear"))return"Ø³Ø§Ø¦Ùˆ Ø¢Ø³Ù…Ø§Ù†";
          if(d.includes("partly")||d.includes("scattered"))return"Ù‡Ù„ÚªÙˆ Ø¨Ø¯Ù„Ø§";
          if(d.includes("cloud"))return"Ú¯Ù‡Ú»Ùˆ Ø¨Ø¯Ù„Ø§";if(d.includes("fog"))return"ÚŒÙ†ÚŒ";
          if(d.includes("rain")&&d.includes("heavy"))return"Ø²ÙˆÚ Ø¨Ø±Ø³Ø§Øª";
          if(d.includes("rain"))return"Ù‡Ù„ÚªÙŠ Ø¨Ø±Ø³Ø§Øª";if(d.includes("thunder"))return"Ø¨Ø¬Ù„ÙŠ/Ø·ÙˆÙØ§Ù†";
          return"Ø§Ú†Ø§Ù†Ú©ØŸ";},
        windFeel(s){if(s>=10)return"ØªÙŠØ² Ù‡ÙˆØ§Ø¦ÙˆÙ†";if(s>=5)return"ÙˆÚ†ÙˆÙ„ÙŠ Ù‡ÙˆØ§Ø¦ÙˆÙ†";return"Ù‡Ù„ÚªÙŠ Ù‡ÙˆØ§Ø¦ÙˆÙ†";}
      }
    };
    labels = all[lang];
    document.getElementById('title').textContent = labels.title;
    document.getElementById('location-input').placeholder = labels.placeholder;
    document.getElementById('search-btn').textContent = labels.btn;
    document.getElementById('footer').textContent = labels.footer;
  }

  // geocode + fetch
  document.getElementById('search-btn').onclick = async ()=>{
    const q=document.getElementById('location-input').value.trim();
    if(!q) return;
    let res=await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(q)}&format=json&limit=1`);
    let js=await res.json();
    if(!js.length){ alert(labels.mapsErr); return; }
    let {lat,lon}=js[0];
    fetchWeather(lat,lon);
  };

  // fetch + render cards
  async function fetchWeather(lat,lon){
    const el=document.getElementById('forecast'); el.innerHTML='Loadingâ€¦';
    let [omR,mtR] = await Promise.all([
      fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,precipitation_probability,wind_speed_10m,weathercode&timezone=Asia%2FKarachi`),
      fetch(`https://api.met.no/weatherapi/locationforecast/2.0/compact?lat=${lat}&lon=${lon}`, {headers:{"User-Agent":"WeatherCompare"}})
    ]);
    let [om,mt]=await Promise.all([omR.json(),mtR.json()]);
    let now=new Date(), out='';
    for(let i=0;i<Math.min(48,om.hourly.time.length);i++){
      let t=new Date(om.hourly.time[i]); if(t<now) continue;
      let dStr=t.toLocaleDateString(lang==='en'?'en-GB':'ur-PK',{day:'2-digit',month:'short',year:'numeric'});
      let tm=t.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'});
      let cod=om.hourly.weathercode[i], desc1=labels.code[cod]||labels.weatherMet(cod+'');
      let feel1=labels.windFeel(om.hourly.wind_speed_10m[i]);
      let metEnt=mt.properties.timeseries.find(e=>new Date(e.time).getHours()===t.getHours());
      let desc2='N/A', feel2='N/A';
      if(metEnt){
        let sum=metEnt.data.next_1_hours?.summary?.symbol_code||'';
        desc2=labels.weatherMet(sum);
        feel2=labels.windFeel(metEnt.data.instant.details.wind_speed);
      }
      out+=`<div class="card">
        <h3>ğŸ“… ${dStr} â€“ ğŸ•’ ${tm}</h3>
        <div class="item"> ğŸŒ¤ï¸ ${labels.title.includes('Weather')?'Open-Meteo':'Open-Meteo'}: <b>${desc1}</b></div>
        <div class="item"> ğŸŒ¡ï¸ <b>Temp:</b> ${om.hourly.temperature_2m[i]}Â°C</div>
        <div class="item"> ğŸŒ§ï¸ <b>Rain:</b> ${om.hourly.precipitation_probability[i]}%</div>
        <div class="item"> ğŸŒ¬ï¸ <b>Wind:</b> ${om.hourly.wind_speed_10m[i]} m/s</div>
        <div class="item"> ğŸŒ€ <b>Feel:</b> ${feel1}</div>
        <div class="item"> ğŸŒ¤ï¸ Met.no: <b>${desc2}</b></div>
        <div class="item"> ğŸŒ€ Feel: ${feel2}</div>
      </div>`;
    }
    el.innerHTML = out;
  }

  // on load: after labels ready, fetch default
  window.onload = ()=> setTimeout(()=>{ fetchWeather(27.84088,69.41302) },300);
  </script>
</body>
</html>